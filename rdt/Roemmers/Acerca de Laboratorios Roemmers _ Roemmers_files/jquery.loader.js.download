jQuery(window).bind('load', function() {
	jQuery('.foreground').toggle('slow');
});

jQuery(function() {
	if (jQuery('html').hasClass('desktop')) {
		jQuery.srSmoothscroll({
			step: 150,
			speed: 800
		});
	}
});

(function($) {
	jQuery(window).load(function($) {
		if (jQuery(".portfolio-grid").length) {
			function getNumColumns() {
				var $folioWrapper = jQuery('#isotope-container').data('cols');

				if ($folioWrapper == '1col') {
					var winWidth = jQuery("#isotope-container").width(),
						column = 1;
					return column;
				}

				else if ($folioWrapper == '2cols') {
					var winWidth = jQuery("#isotope-container").width(),
						column = 2;
					if (winWidth < 380) {
						column = 1;
					}
					return column;
				}

				else if ($folioWrapper == '3cols') {
					var winWidth = jQuery("#isotope-container").width(),
						column = 3;
					if (winWidth < 380) {
						column = 1;
					}
					else if ((winWidth >= 380) && (winWidth < 788)) {
						column = 2;
					}
					else if (winWidth >= 788) {
						column = 3;
					}
					return column;
				}

				else if ($folioWrapper == '4cols') {
					var winWidth = jQuery("#isotope-container").width(),
						column = 4;
					if (winWidth < 380) {
						column = 1;
					}
					else if ((winWidth >= 380) && (winWidth < 788)) {
						column = 2;
					}
					else if ((winWidth >= 788) && (winWidth < 940)) {
						column = 3;
					}
					else if (winWidth >= 940) {
						column = 4;
					}
					return column;
				}
			}

			function setColumnWidth() {
				var columns = getNumColumns(),
					containerWidth = jQuery("#isotope-container").width(),
					postWidth;

				if (columns == 1) {
					postWidth = containerWidth - 30;
				}
				if (columns == 2) {
					postWidth = (containerWidth - 60)/columns;
				}
				if (columns == 3) {
					postWidth = (containerWidth - 90)/columns;
				}
				if (columns == 4) {
					postWidth = (containerWidth - 120)/columns;
				}

				postWidth = Math.floor(postWidth);

				jQuery(".isotope-element").each(function(index) {
					jQuery(this).css({"width" : postWidth + "px"});
				});
			}

			var $container = jQuery('#isotope-container'),
				filters = {},
				items_count = jQuery(".isotope-element").size();

			setColumnWidth();
			$container.isotope({
				itemSelector		: '.isotope-element',
				layoutMode			: 'fitRows',
			});

			jQuery(window).on("debouncedresize", function(event) {
				setColumnWidth();
				$container.isotope()
			});
		};

		if (jQuery.cookie('the_cookie') == 0) {
			styleSwitch(0)
		}

		function styleSwitch(cookie) {
			if (cookie == 0) {
				jQuery('#style-mobile').remove();
				jQuery('#skeleton-mobile').remove();
				jQuery('.switcher').text("Responsive Version");
				jQuery.cookie('the_cookie', 0);
			} else {
				jQuery('head').append('<link rel="stylesheet" href="<?php echo base_path().path_to_theme() ?>/css/style-mobile.css" media="screen" id="style-mobile">');
				jQuery('head').append('<link rel="stylesheet" href="<?php echo base_path().path_to_theme() ?>/css/skeleton-mobile.css" media="screen" id="skeleton-mobile">');
				jQuery('.switcher').text("Desktop Version only");
				jQuery.cookie('the_cookie', 1);
			}
		}

		jQuery('.switcher').click(function() {
			styleSwitch(jQuery.cookie('the_cookie') == 0 ? 1 : 0);
			location.reload();
		});

        var url = jQuery(location).attr('href');
        var urlSplit = url.split('/');

        if (urlSplit[urlSplit.length - 1] == 'productos') {
            if (readCookie('aceptolascondiciones') == null) {
                if (urlSplit[urlSplit.length - 2] == 'es')
                {
                    jQuery('#fade').show();
                    jQuery('.modalEsp').show();
                }
                else
                {
                    jQuery('#fade').show();
                    jQuery('.modalEng').show();
                }
            }
        }
	});
})(jQuery);

function readCookie(name) {
    var nameEQ = encodeURIComponent(name) + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
    }
    return null;
}

jQuery(document).ready(function () {
	jQuery("#isotope-options .option-set li a[data-option-value='.all']").addClass("selected");

	// Sticky menu
	if ((jQuery(window).width() > 995) && (jQuery('#header .stickup').length)) {
		jQuery('#header .stickup').tmStickUp({});
	}

	// Portfolio image size
	jQuery('.tm-masonry-item img').each(function() {
		var width = jQuery(this).parents('.tm-masonry-item').width(),
			height = jQuery(this).parents('.tm-masonry-item').height(),
			h = height/width;

		if (h > 0.5194) {
			jQuery(this).css({height: height, maxWidth: 'inherit'});
		} else {
			jQuery(this).css({height: 'auto', maxWidth: '100%'});
		}
	})

	jQuery(".dd-search.block-search-form").append('<span class="search-button"><i class="fa fa-search"></i></span>');

	jQuery(".contact-form input[type='reset']").on("click", function($) {
		jQuery(this).parents(".contact-form").find(".error").removeClass("error");
	})
});

jQuery(document).ready(function() {
	jQuery('span.search-button').click(function(){
		jQuery('.block-content').toggleClass('active');
	});
	jQuery(document).on('click', function  () {
		if (jQuery('#block-search-form .block-content').hasClass('active')) {
			jQuery('#block-search-form .block-content').removeClass('active');
		}
	})
	jQuery('#block-search-form .block-content, span.search-button').on('click touchstart', function(e){
		e.stopPropagation();
	});
});

jQuery(document).ready(function(){
    //Acordeon
    jQuery('#acordeon div').find('div').hide();

    jQuery('#acordeon h2').click(function(){
            if (jQuery(this).parent('div.active').find('div').is(":visible")) {
                    jQuery('#acordeon div').removeClass('active').find('div').slideUp('fast');
            }else{
                    jQuery('#acordeon div').find('div').slideUp();
                    jQuery('#acordeon div').removeClass('active');
                    jQuery(this).parent('div').addClass('active').find('div').slideDown();
            }
    });
});

jQuery(document).ready(function(){
      jQuery('.page-eventos .item-list ul').slideUp();
      jQuery('.page-eventos h3').removeClass('active');

      var anio_actual = (new Date).getFullYear();//2018;

      jQuery('.page-eventos .item-list h3').each(function(k,v){
        if(jQuery(this).text() == anio_actual){
          jQuery(this).closest('.item-list').addClass('active');
          jQuery(this).closest('.item-list').find('ul').slideDown(400);
        }
      });

      jQuery('.page-eventos .item-list h3').click(function(e){
        e.preventDefault();
        jQuery('.item-list ul').slideUp();
        jQuery('.item-list').removeClass('active');
        if (jQuery(this).closest('.item-list').find('ul').is(":visible")) {
          jQuery(this).closest('.item-list').find('ul').slideUp();
          jQuery(this).closest('.item-list').removeClass('active');
          jQuery(this).closest('.item-list').find('.views-row').removeClass('active');
          jQuery(this).closest('.item-list').find('ul').slideUp();
        } else {
          jQuery(this).closest('.item-list').removeClass('active');
          jQuery(this).closest('.item-list').find('ul').slideUp();
          jQuery(this).closest('.item-list').find('.views-row').removeClass('active');
          jQuery(this).closest('.item-list').find('ul').slideDown(400);
          jQuery(this).closest('.item-list').addClass('active');
        }
      });
    });

  jQuery(document).ready(function() {
    jQuery('.inscribirse_al_evento').bind('click', function(e) {
      e.preventDefault();
      var button  = jQuery(this);
      var form = button.closest('form');
      var data = form.serialize();
      jQuery.ajax({
        url: "https://www.roemmers.com//query.php",
        type: "POST",
        data: data,
        success: function(){
          form.val('Inscripto');
          form.attr('disabled','disabled');
          form.html('Inscripto');
        }
      });
    });
  });


function showallproducts() {
    jQuery('.product-list .product').show();
    jQuery("H3").show();
    jQuery(".linea-terapeutica").css('border-bottom', '1px solid #E5E5E5');
    jQuery(".view-content .linea-terapeutica").removeClass('linea-terapeutica-nuevo');
    jQuery(".page-productos .title_productos").removeClass('titulo-producto-nuevo');
}

jQuery(document).ready(function () {
    jQuery('.page-productos .view-select-de-l-nea-terap-utica select').change(function () {
        showallproducts();

        var LineaTerapeutica = jQuery('.view-select-de-l-nea-terap-utica select').find('option:selected').text().trim();
        var valueLineaTerapeutica = jQuery('.view-select-de-l-nea-terap-utica select').find('option:selected').val();
        var PrincipioActivo = jQuery('.view-select-de-principio-activo select').find('option:selected').text().trim();
        var valuePrincipioActivo = jQuery('.view-select-de-principio-activo select').find('option:selected').val();

		if(valueLineaTerapeutica != "")
		{
			jQuery('.view-select-de-principio-activo select').prop('selectedIndex', 0);
			jQuery('.linea-terapeutica').removeClass('active');
			jQuery('.linea-terapeutica .product-list').slideUp();
			jQuery('.linea-terapeutica .views-row').removeClass('active');
			var value = jQuery(this).find('option:selected').val();
			var dump = value.split('/');
			var termId = dump[dump.length - 1];

			var href = jQuery('.view-content').find('.linea-terapeutica h3 a').attr('href');
			var url = href.substring(0, href.lastIndexOf('/'));
			var myLink = jQuery('.view-content .linea-terapeutica h3 a[href$="' + url + '/' + termId + '"]');
			if (myLink.size() > 0) {
				jQuery('.linea-terapeutica').removeClass('active');
				var linea_terapeutica = myLink.closest('.linea-terapeutica');
				jQuery('.product-list').removeClass('active').slideUp();
				linea_terapeutica.addClass('active').find('.product-list').addClass('active').slideDown();
				jQuery('.product-list').promise().done(function () {
					jQuery('html,body').animate({scrollTop: jQuery(".linea-terapeutica.active h3").offset().top - 200}, 'slow');
				});
			} else {
				var url = jQuery(location).attr('href');
				var urlSplit = url.split('/');

				if (urlSplit[urlSplit.length - 2] == 'es') {
					alert('No se encontraron coincidencias')
				} else {
					alert('No matches were found')
				}
			}

			if (valuePrincipioActivo != '') {
				var VariableCoincidencias = false;
				jQuery('.product-list .product').each(function (k, v) {
					var valueFieldContentLP = jQuery(this).find('.views-field-field-l-nea-terap-utica .field-content').text().trim();
					var valueFieldContentPA = jQuery(this).find('.views-field-field-principio-activo .field-content').text().trim();
					if ((valueFieldContentLP == LineaTerapeutica) && (valueFieldContentPA == PrincipioActivo)) {
						jQuery(this).addClass('active').closest('.product-list').slideDown().closest('.linea-terapeutica').addClass('active');
						VariableCoincidencias = true;
					}
				});
			}
		}
    });
    jQuery('.page-productos .view-select-de-principio-activo select').change(function () {
        showallproducts();

        var LineaTerapeutica = jQuery('.view-select-de-l-nea-terap-utica select').find('option:selected').text().trim();
        var valueLineaTerapeutica = jQuery('.view-select-de-l-nea-terap-utica select').find('option:selected').val();
        var PrincipioActivo = jQuery('.view-select-de-principio-activo select').find('option:selected').text().trim();
        var valuePrincipioActivo = jQuery('.view-select-de-principio-activo select').find('option:selected').val();
		if(valuePrincipioActivo != "")
		{
			if (valueLineaTerapeutica != '') {
				jQuery('.linea-terapeutica').removeClass('active');
				jQuery('.linea-terapeutica .views-row').removeClass('active');
				var VariableCoincidencias = false;
				jQuery('.product-list .product').each(function (k, v) {
					var valueFieldContentLP = jQuery(this).find('.views-field-field-l-nea-terap-utica .field-content').text().trim();
					var valueFieldContentPA = jQuery(this).find('.views-field-field-principio-activo .field-content').text().trim();
					if ((valueFieldContentLP == LineaTerapeutica) && (valueFieldContentPA == PrincipioActivo)) {
						jQuery(this).addClass('active').closest('.product-list').slideDown().closest('.linea-terapeutica').addClass('active');
						VariableCoincidencias = true;
					}
				});
				if (VariableCoincidencias == false) {
					var url = jQuery(location).attr('href');
					var urlSplit = url.split('/');

					if (urlSplit[urlSplit.length - 2] == 'es') {
						alert('No se encontraron coincidencias')
					} else {
						alert('No matches were found')
					}
				};
				jQuery('.product-list').promise().done(function () {
					jQuery('html,body').animate({scrollTop: jQuery(".linea-terapeutica.active h3").offset().top - 200}, 'slow');
				});
			} else {
				jQuery('.view-select-de-l-nea-terap-utica select').prop('selectedIndex', 0);
				jQuery('.linea-terapeutica').removeClass('active');
				jQuery('.linea-terapeutica .product-list').slideUp();
				jQuery('.linea-terapeutica .views-row').removeClass('active');
				var selected_principio_activo = jQuery(this).find('option:selected').text().trim();
				jQuery('.product-list .product').each(function (k, v) {
					var principio_activo = jQuery(this).find('.views-field-field-principio-activo .field-content').text().trim();
					if (selected_principio_activo == principio_activo) {
						jQuery(this).addClass('active').closest('.product-list').slideDown().closest('.linea-terapeutica').addClass('active');
					}
				});
				jQuery('.product-list').promise().done(function(){
				  jQuery('html,body').animate({scrollTop: jQuery(".linea-terapeutica.active h3").offset().top - 200},'slow');
				});
			}
		}
    });

     jQuery('.view-select-productos select').change(function(){
        showallproducts();

        var value = jQuery(this).find('option:selected').val();
        console.log(value);
        var prodId = value.split('::')[1];
        window.location = prodId;
     });

    jQuery('.allproducts').click(function () {
        jQuery('.columna_izquierda section').slideDown();
        jQuery('.linea-terapeutica').removeClass('active');
        jQuery('.linea-terapeutica .product-list').slideUp();
        jQuery('.linea-terapeutica .views-row').removeClass('active');

    });
    jQuery('.linea-terapeutica h3 a').click(function (e) {
        e.preventDefault();
        linea_terapeutica = jQuery(this).closest('.linea-terapeutica');
        linea_terapeutica_menu = linea_terapeutica.find('.product-list');
        if (linea_terapeutica_menu.is(":visible")) {
            linea_terapeutica_menu.slideUp(400);
            jQuery('.linea-terapeutica').removeClass('active');
            jQuery('.linea-terapeutica .views-row').removeClass('active');
            jQuery('.linea-terapeutica .product-list').slideUp();
        } else {
            jQuery('.linea-terapeutica').removeClass('active');
            jQuery('.linea-terapeutica .product-list').slideUp();
            jQuery('.linea-terapeutica .views-row').removeClass('active');
            linea_terapeutica_menu.slideDown(400);
            linea_terapeutica.addClass('active');
        }
    });

    var termId = getUrlParameter('termId');

	if(termId != "")
	{
		jQuery('.view-select-de-l-nea-terap-utica select option[value$="/' + termId + '"]').attr('selected','selected');
		jQuery('.view-select-de-l-nea-terap-utica select').change();
	}

    var prodId = getUrlParameter('prodId');

	if(prodId != "")
	{
		jQuery('.view-select-de-principio-activo select option[value$="/' + prodId + '"]').attr('selected','selected');
		jQuery('.view-select-de-principio-activo select').change();
	}
});

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};


jQuery(document).ready(function(){
	jQuery('.node-type-producto .view-select-de-l-nea-terap-utica select').change(function(e){
		var value = jQuery(this).find('option:selected').val();
		var termId = value.match(/productos\/[a-z\-]+/)[0].split('/')[1];

		var url = jQuery(location).attr('href');
		var urlSplit = url.split('/');
		var aux = urlSplit.splice(urlSplit.length - 1);

		var newUrl = urlSplit.join("/");
		window.location = newUrl + '?termId='+termId;
	});
	jQuery('.node-type-producto .view-select-de-principio-activo select').change(function(){
		var value = jQuery(this).find('option:selected').val();
		var valueSplit = value.split('/');
		var prodId = valueSplit[valueSplit.length - 1];

		var url = jQuery(location).attr('href');
		var urlSplit = url.split('/');
		urlSplit.splice(urlSplit.length - 1);

		var newUrl = urlSplit.join("/");
		window.location = newUrl + '?prodId='+prodId;
	});
});

// Tiled gallery
jQuery(window).bind('resize', function() {
	jQuery('.tm-masonry-item img').each(function() {
		var width = jQuery(this).parents('.tm-masonry-item').width(),
			height = jQuery(this).parents('.tm-masonry-item').height(),
			h = height/width;

		if (h > 0.5194) {
			jQuery(this).css({height: height, maxWidth: 'inherit'});
		} else {
			jQuery(this).css({height: 'auto', maxWidth: '100%'});
		}
	})
})

// Back to Top Button
jQuery(window).load(function() {
	jQuery().UItoTop({
		easingType: 'easeOutQuart',
		containerID: 'backtotop'
	});
})

// Mobile menu
jQuery(window).load(function() {
	jQuery('#superfish-1').mobileMenu();
})
